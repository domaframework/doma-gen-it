apply plugin: 'java'
apply plugin: 'groovy'

version = '2.0-beta-4-SNAPSHOT'
processResources.destinationDir = compileJava.destinationDir
compileJava.dependsOn processResources

compileJava {
    options.encoding = 'UTF-8'
}
 
compileTestJava {
    options.encoding = 'UTF-8'
}
 
jar {
    manifest {
        attributes 'Implementation-Title': 'Doma-Gen-IT', 'Implementation-Version': version
    }
}

task gen << {
    ant.taskdef(
        resource: 'domagentask.properties', 
        classpath:configurations.antRuntime.plus(sourceSets.main.output).asPath) {
    }
    ext {
        javaDestDir = 'src/gen/java'
        resourcesDestDir = 'src/gen/resources'
    }
    ant.gen(
        url: 'jdbc:hsqldb:mem:doma_gen_it', 
        user: '',
        password: '',
        globalFactoryClassName: 'org.seasar.doma.extension.gen.it.GenItGlobalFactory',
        ) {
            entityConfig(destDir: javaDestDir)
            daoConfig(destDir: javaDestDir)
            sqlConfig(destDir: resourcesDestDir)
    }
}

gen.dependsOn compileJava

task wrapper(type: Wrapper) {
    gradleVersion = '1.11'
}

configurations {
    antRuntime
}

repositories {
    mavenCentral()
    mavenLocal()
    maven {url 'https://oss.sonatype.org/content/repositories/snapshots/'}
}
 
dependencies {
    compile "org.seasar.doma:doma-gen:${version}"
    antRuntime "org.seasar.doma:doma-gen:${version}"
    antRuntime 'org.hsqldb:hsqldb:2.3.2'
}

apply from:'eclipse.gradle'